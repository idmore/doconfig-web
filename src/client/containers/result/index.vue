<template lang='pug'>
.createconf
    //- subheader
    subheader(
        :name='type'
        link='https://docs.docker.com/engine/reference/builder/'
        title='Create Dockerfile'
        subtitle='Docker can build images automatically by reading the instructions from a Dockerfile. A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image. Using docker build users can create an automated build that executes several command-line instructions in succession. More about Dockerfile')

    section
        .container-md
            .grid
                .col-12.p-b-0
                    .createconf-form 
                        //- image
                        .createconf-form-control
                            label
                                router-link.fa.fa-chevron-left(
                                    :to='link_back' 
                                    style='margin-right:10px;font-size:28px' 
                                    title='back to create config') 
                                | {{type}} Result
                            code(v-html='html_result')

            //- generate button
            .align-center
                a.btn.btn-lg.btn-blue(:href='txt_result_link' download="dockerfile") Download dockerfile
                | &nbsp;
                button.btn.btn-lg.btn-white(type='button' v-on:click='copyText') Copy to Clipboard
                .m-sm
                                
</template>
<script>
import Vue from 'vue'
import subheader from '../../components/subheader.vue'
import { router } from '../../index'
import { toSingleSpace } from 'string-manager'
import { nl2br } from '../../helpers/string'
import { saveConf } from '../../store/actions'
import copy from 'copy-to-clipboard'

// register component
Vue.component('subheader', subheader)

const result = `# generated by Doconfig - https://doconfig.byidmore.com
FROM node:6.9.1-slim
MAINTAINER https://doconfig.com/report
RUN export DEBIAN_FRONTEND=noninteractive && set -x \
&& npm install -g nodemon \
&& mkdir -p /usr/src/app
WORKDIR /usr/src/app
COPY package.json /usr/src/app
COPY . /usr/src/app
EXPOSE 8080
CMD ['npm','start']`

export default {
  name: 'result-page',
  data() {
      return {
        link_back: `/config/${this.type}`,
        html_result: nl2br(result),
        txt_result_link: `data:application/octet-stream;charset=utf-8,${toSingleSpace(encodeURIComponent(result))}`
      }
  },
  methods: {
      copyText() {
          dc.alert.open('success', 'Dockerfile config is copied to clipboard')
          copy(this.result)
      }
  },
  created() {
    const { type } = this
    // if config not available in store, redirect to craate config file
    if(Object.keys(this.$store.state.config[type]).length < 1)
    {
        console.log('redirect to create config...')
        router.push({path: `/config/${type}`})
    }
  },
  props: {
      type: {
          type: String
      }
  }
}
</script>
